<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Structural Terminal</title>
  <style>
    /* Basic “dark terminal” styling – adjust to taste */
    body {
      margin: 0;
      padding: 0;
      font-family: Menlo, Consolas, Monaco, monospace;
      background-color: #1e1e1e;
      color: #ffffff;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    #terminalOutput {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      border-bottom: 1px solid #333;
    }

    #terminalInput {
      padding: 8px 12px;
      font-size: 14px;
      background-color: #252526;
      color: #c5c5c5;
      border: none;
      border-top: 1px solid #333;
      outline: none;
    }

    #terminalInput:disabled {
      color: #555;
      background-color: #2d2d2d;
    }

    .prompt-line {
      display: flex;
      align-items: center;
    }

    .prompt-line > span.prompt-symbol {
      margin-right: 6px;
      color: #00ff00; /* green “>” */
    }

    .output-line {
      white-space: pre-wrap;
    }

    .loading {
      color: #cccccc;
    }

    .error {
      color: #f44747; /* red */
    }
  </style>
</head>
<body>

  <!-- Input field: disabled until both JSONs load -->
  <input
    type="text"
    id="terminalInput"
    placeholder="(Loading…)"
    disabled
    autocomplete="off"
  />

  <!-- Output area -->
  <div id="terminalOutput">
    <!-- Initial “loading” message: -->
    <div class="prompt-line loading">
      <span class="prompt-symbol">&gt;</span>
      <span>Loading data…</span>
    </div>
  </div>

  <!-- All JavaScript lives here -->
  <script>
    // ------------------------------------------------------------------------
    // 1) Variables to hold loaded JSON data and “loaded” flags:
    // ------------------------------------------------------------------------
    let wShapeData = null;
    let mcShapeData = null;
    let wShapeLoaded = false;
    let mcShapeLoaded = false;

    // ------------------------------------------------------------------------
    // 2) Utility: print a new line of text into #terminalOutput
    //    - argument `text` can be a string (plain text) or
    //      an HTML‐formatted string if you want color, etc.
    // ------------------------------------------------------------------------
    function printLine(text, cssClass = "output-line") {
      const outDiv = document.getElementById("terminalOutput");
      const line = document.createElement("div");
      line.className = cssClass;
      line.innerText = text;
      outDiv.appendChild(line);

      // Scroll to bottom whenever a new line is printed
      outDiv.scrollTop = outDiv.scrollHeight;
    }

    // ------------------------------------------------------------------------
    // 3) After BOTH JSONs have loaded, enable the input:
    // ------------------------------------------------------------------------
    function tryEnableInput() {
      if (wShapeLoaded && mcShapeLoaded) {
        const input = document.getElementById("terminalInput");
        input.disabled = false;
        input.placeholder = "Search a shape (e.g. W12X16)…";
        input.focus();

        // Remove the initial “Loading data…” line:
        document.getElementById("terminalOutput").innerHTML = "";
        // Print a welcome message now that data is available:
        printLine("> Data loaded. Type a shape name and press Enter.");
      }
    }

    // ------------------------------------------------------------------------
    // 4) Fetch W‐section JSON
    // ------------------------------------------------------------------------
    fetch("js/w-member-data.json")
      .then((resp) => {
        if (!resp.ok) throw new Error(`W JSON HTTP ${resp.status}`);
        return resp.json();
      })
      .then((json) => {
        wShapeData = json;
        wShapeLoaded = true;
        tryEnableInput();
      })
      .catch((err) => {
        console.error("❌ Error loading W JSON:", err);
        // Show an error on screen:
        document.getElementById("terminalOutput").innerHTML = "";
        printLine("Error: Could not load W‐member JSON.", "error");
      });

    // ------------------------------------------------------------------------
    // 5) Fetch MC‐section JSON
    // ------------------------------------------------------------------------
    fetch("js/mc-member-data.json")
      .then((resp) => {
        if (!resp.ok) throw new Error(`MC JSON HTTP ${resp.status}`);
        return resp.json();
      })
      .then((json) => {
        mcShapeData = json;
        mcShapeLoaded = true;
        tryEnableInput();
      })
      .catch((err) => {
        console.error("❌ Error loading MC JSON:", err);
        document.getElementById("terminalOutput").innerHTML = "";
        printLine("Error: Could not load MC‐member JSON.", "error");
      });

    // ------------------------------------------------------------------------
    // 6) Handle “Enter” key presses in the input
    //    - When user types e.g. “W12X16” and presses Enter, look it up.
    //    - If found in wShapeData, print the full JSON object for that shape.
    //    - Otherwise, check mcShapeData for a matching key.
    //    - If still not found, print “Not found.”
    // ------------------------------------------------------------------------
    document
      .getElementById("terminalInput")
      .addEventListener("keydown", function (evt) {
        if (evt.key === "Enter") {
          const rawValue = this.value.trim().toUpperCase();
          this.value = ""; // clear input
          if (!rawValue) return;

          // Print the prompt line with the user’s request
          printLine(`> ${rawValue}`, "prompt-line");

          // First, check W shapes:
          if (wShapeData && wShapeData[rawValue]) {
            const shapeObj = wShapeData[rawValue];
            // Convert to a pretty‐printed string:
            const pretty = JSON.stringify(shapeObj, null, 2);
            printLine(pretty);
            return;
          }

          // Next, check MC shapes:
          if (mcShapeData && mcShapeData[rawValue]) {
            const shapeObj = mcShapeData[rawValue];
            const pretty = JSON.stringify(shapeObj, null, 2);
            printLine(pretty);
            return;
          }

          // If not found in either:
          printLine(`Shape “${rawValue}” not found.`, "error");
        }
      });
  </script>
</body>
</html>